<!DOCTYPE html>
<html lang="en-EN">
	<head>
		<script type="text/javascript" src="modified-binary-search.js"></script>
		<script type="text/javascript" src="formulas.js"></script>
		<script type="text/javascript" src="bpm-timeline.js"></script>
		<script type="text/javascript" src="http://mbostock.github.com/d3/d3.v2.js"></script>
		<style>
			/* tell the SVG path to be a thin blue line without any area fill */
			path {
				stroke: steelblue;
				stroke-width: 1;
				fill: none;
			}
			.axis {
				shape-rendering: crispEdges;
			}
			.x.axis line {
				stroke: lightgrey;
			}
			.x.axis .minor {
				stroke-opacity: .5;
			}
			.x.axis path {
				display: none;
			}
			.y.axis line, .y.axis path {
				fill: none;
				stroke: #000;
			}
		</style>
	</head>
	<body>
		<div id="graph" class="aGraph" style="position:absolute;top:0px;left:0; float:left;"></div>
		<script type="text/javascript">
			var automation = new BPMTimeline(60);
			automation.add_bpm_marker({
				type: "linear",
				endBeat: 50,
				endBPM : 10
			});
			automation.add_bpm_marker({
				type: "linear",
				endBeat: 100,
				endBPM : 140
			});
			automation.add_bpm_marker({
				type: "linear",
				endBeat: 120,
				endBPM : 50
			});
			automation.add_bpm_marker({
				type: "linear",
				endBeat: 125,
				endBPM : 10
			});
			automation.add_bpm_marker({
				type: "linear",
				endBeat: 130,
				endBPM : 1
			});
			automation.add_bpm_marker({
				type: "linear",
				endBeat: 140,
				endBPM : 100
			});


			var data = [];
			var markers = automation.get_markers();
			var xmax = markers[markers.length-1].endBeat;
			for (var i = 0; i < xmax; i+=0.01) {
				data.push({ y: automation.time(i), x: i });
			}
			var ymax = data[data.length-1].y;

			// define dimensions of graph
			var m = [80, 80, 80, 80]; // margins
			var w = 600 - m[1] - m[3]; // width
			var h = 400 - m[0] - m[2]; // height

			var x = d3.scale.linear().domain([0, xmax]).range([0, w]);
			var y = d3.scale.linear().domain([0, ymax]).range([h, 0]);
			var line = d3.svg.line()
			    .x(function(d) {
			        return x(d.x);
			    })
			    .y(function(d) {
			        return y(d.y);
			    })

			var graph = d3.select("#graph").append("svg:svg")
			.attr("width", w + m[1] + m[3])
			.attr("height", h + m[0] + m[2])
			.append("svg:g")
			.attr("transform", "translate(" + m[3] + "," + m[0] + ")");

			var xAxis = d3.svg.axis().scale(x).tickSize(-h).tickSubdivide(true);
			graph.append("svg:g")
			.attr("class", "x axis")
			.attr("transform", "translate(0," + h + ")")
			.call(xAxis);


			var yAxisLeft = d3.svg.axis().scale(y).ticks(4).orient("left");
			graph.append("svg:g")
			.attr("class", "y axis")
			.attr("transform", "translate(-25,0)")
			.call(yAxisLeft);

			// Add the line by appending an svg:path element with the data line we created above
			// do this AFTER the axes above so that the line is above the tick-lines
			graph.append("svg:path").attr("d", line(data));
		</script>
	</body>
</html>